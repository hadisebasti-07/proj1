{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the MarketConnect application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the User entity, matching Firebase Auth UID."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "role": {
          "type": "string",
          "description": "The user's role within the application (customer, provider, or admin).",
          "enum": ["customer", "provider", "admin"]
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "uid",
        "name",
        "email",
        "phone",
        "role",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Includes denormalized 'role' field for authorization independence. This allows list operations to be secured using role-based access control.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to track admin users based on the existence of a document with the user's ID. Existence implies the user is an admin. Used for DBAC (Database-driven Access Control).",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage user data securely and efficiently within the MarketConnect application. It follows the principle of Authorization Independence by storing user roles directly within each user document, avoiding the need for complex `get()` calls in security rules. The structure uses segregated paths for user data, ensuring a homogeneous security posture. Specifically, user profiles are stored at `/users/{userId}`, and their roles are included directly in the User document. This enables straightforward role-based access control. QAPs are supported because listing users can be secured based on roles without needing to filter based on content, thanks to the denormalized role data."
  }
}
